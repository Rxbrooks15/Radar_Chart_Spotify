<!DOCTYPE html>
<html>
<head>
    <meta http-equiv="Content-Type" content="text/html;charset=utf-8"/>
    <title>Radar plot documenting differences in attributes across music genres</title>

    <!-- Google fonts -->
    <link href='http://fonts.googleapis.com/css?family=Open+Sans:400,300' rel='stylesheet' type='text/css'>
    <link href='https://fonts.googleapis.com/css?family=Raleway' rel='stylesheet' type='text/css'>

    <!-- D3.js -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/d3/3.5.6/d3.min.js" charset="utf-8"></script>

    <style>
        body {
            font-family: 'Open Sans', sans-serif;
            font-size: 11px;
            font-weight: 300;
            fill: #242424;
            text-align: center;
            text-shadow: 0 1px 0 #fff, 1px 0 0 #fff, -1px 0 0 #fff, 0 -1px 0 #fff;
            cursor: default;
        }

        .legend {
            font-family: 'Raleway', sans-serif;
            fill: #333333;
            text-align: left;
            padding-left: 20px;
            position: absolute;
            top: 20px;
            left: 20px;
        }

        .legend-item {
            margin-bottom: 5px;
        }

        .legend-color {
            display: inline-block;
            width: 10px;
            height: 10px;
            margin-right: 15px;
        }

        /* Tooltip style */
        #tooltip {
            position: absolute;
            background-color: rgba(255, 255, 255, 0.8);
            border: 1px solid #ccc;
            padding: 5px;
            border-radius: 5px;
            pointer-events: none; /* Ensure tooltip doesn't interfere with mouse events */
            display: none; /* Initially hidden */
        }

        /* Title style */
        #title {
            font-size: 20px;
            font-weight: bold;
            margin-bottom: 20px;
        }
    </style>

</head>
<body>

<div id="title">Radar plot documenting differences in attributes across music genres</div>

<div class="radarChart"></div>
<div class="legend" id="legend"></div>

<!-- Tooltip element -->
<div id="tooltip"></div>

<script src="radarChart.js"></script>
<script>

    /* Radar chart design created by Nadieh Bremer - VisualCinnamon.com */

    //////////////////////////////////////////////////////////////
    ///////////////////////// Set-Up //////////////////////////////
    //////////////////////////////////////////////////////////////

    var margin = {top: 100, right: 100, bottom: 100, left: 100},
        width = Math.min(700, window.innerWidth - 10) - margin.left - margin.right,
        height = Math.min(width, window.innerHeight - margin.top - margin.bottom - 20);

    //////////////////////////////////////////////////////////////
    //////////////////////////// Data //////////////////////////////
    //////////////////////////////////////////////////////////////

    // Load data from genre.csv
    d3.csv("genres.csv", function (data) {
        // Group data by genre and calculate average values
        var groupedData = d3.nest()
            .key(function(d) { return d.genre; })
            .rollup(function(v) {
                return {
                    danceability: d3.mean(v, function(d) { return parseFloat(d.danceability); }),
                    liveness: d3.mean(v, function(d) { return parseFloat(d.liveness); }),
                    energy: d3.mean(v, function(d) { return parseFloat(d.energy); }),
                    speechiness: d3.mean(v, function(d) { return parseFloat(d.speechiness); }),
                    instrumentalness: d3.mean(v, function(d) { return parseFloat(d.instrumentalness); }),
                    valence: d3.mean(v, function(d) { return parseFloat(d.valence); })
                };
            })
            .entries(data);

        // Format data for radar chart
        var formattedData = groupedData.map(function(group) {
            return Object.keys(group.values).map(function(key) {
                return { axis: key.charAt(0).toUpperCase() + key.slice(1), value: group.values[key] };
            });
        });

        // Output the formatted data array to the console
        console.log(groupedData);
        console.log(formattedData);

        //////////////////////////////////////////////////////////////
        ////////////////////// Draw the Chart //////////////////////////
        //////////////////////////////////////////////////////////////

        var color = d3.scale.category10(); // Unique color scale for each genre

        var radarChartOptions = {
            w: width,
            h: height,
            margin: margin,
            maxValue: 0.7, // Change maxValue to 1
            levels: 5,
            roundStrokes: true,
            color: color
        };
        // Call function to draw the Radar chart
        RadarChart(".radarChart", formattedData, radarChartOptions);

        // Add legend
        var legend = d3.select("#legend");
        var uniqueGenres = groupedData.map(function(d) { return d.key; });
        var legendItems = legend.selectAll(".legend-item")
            .data(uniqueGenres)
            .enter().append("div")
            .attr("class", "legend-item");

        legendItems.append("div")
            .attr("class", "legend-color")
            .style("background-color", function(d, i) { return color(i); });

        legendItems.append("span")
            .text(function(d) { return d; });

        // Add event listener to legend items
        legendItems.on("click", function(selectedGenre) {
            // Filter the radar chart data based on the selected genre
            var filteredData = formattedData.filter(function(d) {
                return d[0].axis === selectedGenre;
            });

            // Call function to draw the Radar chart with the filtered data
            RadarChart(".radarChart", filteredData, radarChartOptions);

            // Highlight the selected legend item
            legendItems.style("opacity", 0.5); // Dim all legend items
            d3.select(this).style("opacity", 1); // Highlight the selected legend item
        });

        // Add event listener to radar chart areas
        var radarAreas = document.querySelectorAll('.radarArea');
        radarAreas.forEach(function(area, index) {
            area.setAttribute('data-genre', groupedData[index].key); // Associate genre name with each area
            area.addEventListener('mouseover', function() {
                // Retrieve genre name
                var genre = this.getAttribute('data-genre');
                console.log("Genre: " + genre);

                // Show genre at the top of the page
                var genreDisplay = document.getElementById('genre-display');
                genreDisplay.textContent = "Genre: " + genre;
                genreDisplay.style.display = "block"; // Show genre display
            });

            area.addEventListener('mouseout', function() {
                // Hide genre display when mouse leaves the area
                var genreDisplay = document.getElementById('genre-display');
                genreDisplay.style.display = "none";
            });
        });
    });
</script>

<!-- Display genre at the top of the page -->
<div id="genre-display" style="display: none; position: absolute; top: 120px; left: 50%; transform: translateX(-50%);"></div>

</body>
</html>
